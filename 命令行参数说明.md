# 命令行参数说明

## 功能

现在支持通过命令行参数直接启动 API 模式，无需手动选择菜单。

## 使用方法

### 方式一：直接启动 API 模式

```bash
python3 main.py api
```

这将直接启动 Web API 服务器，跳过菜单选择。

### 方式二：正常显示 UI 菜单（默认）

```bash
python3 main.py
```

或者

```bash
python3 main.py --help
```

这将显示正常的交互式菜单，可以选择不同的功能模式。

## 使用示例

### 启动 API 模式

```bash
# 直接启动 API 服务器
python3 main.py api
```

启动后会：
1. 显示项目信息
2. 检查配置
3. 确认免责声明
4. 直接启动 API 服务器（端口 5555）

### 访问 API 文档

启动 API 模式后，可以访问：
- API 文档：http://127.0.0.1:5555/docs
- ReDoc 文档：http://127.0.0.1:5555/redoc

### 使用 systemd 服务（推荐）

创建服务文件 `/etc/systemd/system/tiktok-downloader-api.service`：

```ini
[Unit]
Description=TikTok Downloader API Server
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/tiktok/TikTokDownloader
ExecStart=/usr/bin/python3 main.py api
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
sudo systemctl daemon-reload
sudo systemctl enable tiktok-downloader-api
sudo systemctl start tiktok-downloader-api
```

查看状态：
```bash
sudo systemctl status tiktok-downloader-api
```

查看日志：
```bash
sudo journalctl -u tiktok-downloader-api -f
```

### 使用 Docker

如果使用 Docker，可以在启动命令中添加参数：

```bash
docker run --name tiktok-downloader \
  -p 5555:5555 \
  -v tiktok_downloader_volume:/app/Volume \
  -it tiktok-downloader python3 main.py api
```

或者在 Dockerfile 中修改 CMD：

```dockerfile
CMD ["python3", "main.py", "api"]
```

## 注意事项

1. **首次运行**：首次运行仍需要配置 Cookie，可以通过菜单选择配置
2. **免责声明**：API 模式启动时仍需要确认免责声明
3. **Token 验证**：如果配置了 Token 验证，API 请求需要提供有效的 token
4. **端口占用**：确保端口 5555 未被占用

## 测试 API

启动 API 模式后，可以测试：

```bash
# 测试 token 验证（如果配置了 token）
curl -H "token: your-secret-token" http://127.0.0.1:5555/token

# 测试 API 接口
curl -H "token: your-secret-token" \
     -H "Content-Type: application/json" \
     -X POST \
     -d '{"detail_id": "123456789"}' \
     http://127.0.0.1:5555/douyin/detail
```

## 停止服务

### 前台运行
按 `Ctrl + C` 停止

### systemd 服务
```bash
sudo systemctl stop tiktok-downloader-api
```

### Docker 容器
```bash
docker stop tiktok-downloader
```

